---
import { Image } from "astro:assets";
import SectionTitle from "./SectionTitle.astro";
import ExpertiseAreasIllustration from "@/assets/images/expertise-areas-illustration.webp";
import ExpertiseAreasAccordion from "./ExpertiseAreasAccordion";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { delay } from "@/utils/utils";

const lang = getLangFromUrl(Astro.url);
const translationContent = useTranslations(lang);
const { title } = translationContent.expertiseAreas;

const builderAPIpublicKey = import.meta.env.BUILDER_API_PUBLIC_KEY;
const isProduction = import.meta.env.PROD;

if (isProduction) {
  // Force the delay of request to CMS to wait 30 seconds because CMS takes some seconds to refresh data.
  await delay(30000);
}

const { results } = await fetch(
  `https://cdn.builder.io/api/v3/content/expertise-areas?apiKey=${builderAPIpublicKey}`,
)
  .then((res) => res.json())
  .catch();

const areas = results[0].data.expertiseAreas;
---

<section
  id="expertise-areas"
  class="h-fit sm:h-[120vh] relative flex flex-col gap-2 sm:gap-20"
>
  <Image
    class="absolute -z-10 inset-0 object-cover h-full w-full hidden sm:block"
    src={ExpertiseAreasIllustration}
    alt="Image do logo de Delfim Maia"
  />

  <div
    class={"w-full bg-delfim-primary sm:w-fit py-1 px-8 sm:pl-20 sm:pr-6 sm:relative sm:top-12"}
  >
    <h5
      class="uppercase font-bold text-white text-4xl text-center sm:text-right"
    >
      {title}
    </h5>
  </div>

  <ExpertiseAreasAccordion
    currentLanguage={lang}
    expertiseAreas={areas}
    client:load
  />
</section>
